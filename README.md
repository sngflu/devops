# Приложение для анализа видео с интеграцией MinIO

## Описание

Это приложение предназначено для анализа видеозаписей, обнаружения оружия и ножей на видео и сохранения результатов. В качестве хранилища данных используется MinIO - S3-совместимое объектное хранилище.

## Требования

- Docker и Docker Compose
- Python 3.10+

## Запуск приложения

1. Клонируйте репозиторий:
   ```
   git clone <repository-url>
   cd <repository-directory>
   ```

2. Запустите контейнеры с помощью Docker Compose:
   ```
   docker-compose up -d
   ```

3. Приложение будет доступно по адресу:
   - Backend API: http://localhost:5174
   - MinIO Console: http://localhost:9001 (логин: minioadmin, пароль: minioadmin)
   - PgAdmin: http://localhost:5050 (логин: admin@example.com, пароль: admin)

## Хранение данных в MinIO

Приложение настроено на использование MinIO в качестве основного хранилища видео и логов обработки. Это обеспечивает:
- Масштабируемость и высокую доступность
- Совместимость с AWS S3 API
- Безопасное хранение данных

### Просмотр данных в MinIO

1. Откройте консоль MinIO: http://localhost:9001
2. Войдите с учетными данными (minioadmin/minioadmin)
3. Перейдите в секцию "Buckets"
4. Вы увидите два бакета:
   - `videos` - для хранения видеофайлов
   - `logs` - для хранения логов обработки

### Миграция с локального хранилища

Если у вас есть существующие данные в локальном хранилище, вы можете мигрировать их в MinIO:

```bash
# Из корня проекта
python -m app.utils.migrate_to_minio
```

Подробную информацию о работе с MinIO можно найти в файле [backend/README_MINIO.md](backend/README_MINIO.md).

## Структура проекта

- `backend/` - Код бэкенда
  - `app/` - Код приложения
    - `api/` - API маршруты и контроллеры
    - `models/` - Модели для обнаружения объектов
    - `services/` - Сервисы приложения
      - `minio_storage.py` - Интеграция с MinIO
      - `video_storage.py` - Абстракция для работы с хранилищем
      - `video_processing.py` - Обработка видео и обнаружение объектов
  - `tests/` - Тесты
  - `utils/` - Утилиты, включая миграцию в MinIO
- `storage/` - Директория для временного локального хранения
- `docker-compose.yml` - Конфигурация Docker

## API Endpoints

- `POST /login` - Авторизация пользователя
- `POST /register` - Регистрация нового пользователя
- `POST /predict` - Загрузка и анализ видео
- `GET /videos` - Получение списка видео
- `GET /video/<filename>` - Получение видео
- `GET /video/<filename>/url` - Получение временной ссылки на видео
- `GET /videos/<filename>/logs` - Получение логов анализа видео
- `DELETE /videos/<filename>` - Удаление видео и логов
- `PUT /videos/<filename>` - Обновление информации о видео

## Решение проблем

### Проблемы с доступом к MinIO

Если возникают проблемы с доступом к MinIO:

1. Проверьте, что контейнер MinIO запущен:
   ```
   docker ps | grep minio
   ```

2. Проверьте логи MinIO:
   ```
   docker logs minio
   ```

3. Проверьте, что бэкенд имеет доступ к MinIO:
   ```
   docker exec -it backend ping minio
   ```

### Ошибки при загрузке видео

1. Проверьте, что видео имеет поддерживаемый формат (.mp4, .avi, .mov, .mkv)
2. Проверьте, что размер видео не превышает 100 МБ
3. Проверьте, что MinIO доступен и имеет достаточно места

> Примечание: Если MinIO недоступен, система автоматически сохранит видео в локальном хранилище.
