# Использование MinIO для хранения видео

В системе реализовано хранение видео и логов обработки в MinIO - высокопроизводительном объектном хранилище, совместимом с Amazon S3.

## Преимущества использования MinIO

1. **Масштабируемость** - MinIO позволяет хранить петабайты данных и легко масштабироваться по горизонтали
2. **Высокая доступность** - распределенная архитектура обеспечивает отказоустойчивость
3. **S3-совместимый API** - полная совместимость с AWS S3 API
4. **Безопасность** - шифрование данных, контроль доступа, аудит
5. **Производительность** - высокая скорость чтения/записи

## Настройка MinIO

### Запуск с помощью Docker Compose

Добавьте следующую конфигурацию в ваш `docker-compose.yml`:

```yaml
services:
  minio:
    image: minio/minio
    container_name: minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    volumes:
      - minio_data:/data
    command: server /data --console-address ":9001"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
    networks:
      - app-network

volumes:
  minio_data:
```

### Настройка переменных окружения для бэкенда

Бэкенд настроен на использование MinIO по умолчанию. Для настройки подключения используйте следующие переменные окружения:

```
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_SECURE=false
```

Для Docker можно добавить эти переменные в секцию `environment` для сервиса бэкенда:

```yaml
services:
  backend:
    # ...
    environment:
      - MINIO_ENDPOINT=minio:9000
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin
      - MINIO_SECURE=false
    depends_on:
      - minio
```

## Миграция существующих данных

Если у вас уже есть загруженные видео в локальном хранилище, вы можете мигрировать их в MinIO с помощью утилиты:

```bash
# Из корня проекта
python -m app.utils.migrate_to_minio
```

Утилита:
1. Просканирует директорию с локальными видео
2. Загрузит видео и логи в MinIO
3. По запросу пользователя удалит локальные копии после успешной миграции

## Проверка работы

### Доступ к консоли MinIO

Консоль управления MinIO доступна по адресу http://localhost:9001

Логин: `minioadmin`
Пароль: `minioadmin`

### Проверка хранилища

В консоли MinIO вы должны увидеть два бакета:
- `videos` - для хранения видеофайлов
- `logs` - для хранения логов обработки

## Настройка для production-окружения

Для production-окружения рекомендуется:

1. Изменить учетные данные по умолчанию
2. Настроить SSL-шифрование (установить `MINIO_SECURE=true`)
3. Настроить резервное копирование данных
4. Использовать распределенную установку MinIO для обеспечения высокой доступности

## Решение проблем

### Не удается подключиться к MinIO

Проверьте:
- Доступность сервера MinIO
- Правильность учетных данных
- Сетевую доступность (особенно в Docker-окружении)

### Ошибки при загрузке файлов

Проверьте:
- Наличие достаточного места на диске
- Права доступа
- Логи MinIO

Если MinIO недоступен, система автоматически будет использовать локальное хранилище как запасной вариант. 